{"componentChunkName":"component-mdx.js","path":"/edge-certificates/universal-ssl/changing-dcv-method","result":{"data":{"mdx":{"id":"bf76252e-bfa7-56b9-bcbf-a4a3edc4f227","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"order\": 2,\n  \"pcx-content-type\": \"how-to\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"change-dcv-method\"\n  }, \"Change DCV method\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"what-is-domain-control-validation-dcv\"\n  }, \"What is Domain Control Validation (DCV)?\"), mdx(\"p\", null, \"Before a publicly trusted Certificate Authority will issue a certificate for a hostname, the requester must prove they have control over that hostname.\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"(Domain and hostname are used interchangeably in this context)\")), mdx(\"p\", null, \"There are several methods that are used to complete this process, the primary ones that Cloudflare works with are:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"HTTP Token\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"CNAME DNS Record\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"TXT DNS Record\")), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"completing-dcv-for-a-domain-using-cloudflare\"\n  }, \"Completing DCV for a domain using Cloudflare\"), mdx(\"p\", null, \"When signing up with Cloudflare by updating your registrar to use Cloudflare nameservers, Cloudflare is able to automatically handle DCV on your behalf.\"), mdx(\"p\", null, \"For domains using a CNAME setup, this process is not as straightforward.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Changing DCV Methods for a Certificate Order is primarily a topic for CNAME setup zones.\")), mdx(\"p\", null, \"With Universal SSL under a CNAME setup, by default, Cloudflare will place an HTTP token to complete DCV.  This token is available for the Certificate Authority as soon as:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Hostname has a CNAME to Cloudflare from the domain\\u2019s authoritative DNS.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Hostname is Orange-Clouded in Cloudflare\\u2019s DNS settings.\")), mdx(\"p\", null, \"This means that by default the above items must be complete for a given hostname before certificates are issued.\"), mdx(\"p\", null, \"The process of certificates being issued once DNS is changed is reported to be very fast, however you may require firm reassurance that your certificates are ready prior to making the switch to avoid any potential downtime.\"), mdx(\"p\", null, \"Using the Client API, we can change the validation method used to allow the certificates to be issued before cutting over live traffic.\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"apex-validation\"\n  }, \"Apex validation\"), mdx(\"p\", null, \"Even though the proxy service isn\\u2019t expected to be provided for this hostname unless switching to a Full DNS configuration with Cloudflare, completing the process above for the apex of a domain will allow us to complete DCV for all subdomains.\"), mdx(\"p\", null, \"As a matter of best practice, it\\u2019s best to validate against the apex, even if you don\\u2019t intend on proxying traffic for the apex in your CNAME setup.\"), mdx(\"p\", null, \"Otherwise, each subdomain needs to be validated manually.\"), mdx(\"h3\", {\n    \"id\": \"1-check-validation-method\"\n  }, \"1. Check validation method\"), mdx(\"p\", null, \"To begin, find the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cert_pack_uuid\"), \" of the order that you would like to change validation method for.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"curl -sX GET \\\\\\n\\\"https://api.cloudflare.com/client/v4/zones/:zone_id/ssl/verification/\\\" \\\\\\n-H 'X-Auth-Email: YOUR_EMAIL' \\\\\\n-H 'X-Auth-Key: API_KEY'\\n\\n{\\n    \\\"result\\\": [\\n        {\\n            \\\"certificate_status\\\": \\\"pending_validation\\\",\\n            \\\"cert_pack_uuid\\\": \\\"4228d4df-b9c7-47bb-8903-ff76452458b1\\\",\\n            \\\"validation_method\\\": \\\"http\\\",\\n            \\\"validation_type\\\": \\\"dv\\\",\\n            \\\"verification_info\\\": {\\n                \\\"http_url\\\": \\\"http://example.com/.well-known/pki-validation/ca3-15cd5a33b4fd469784851d8c021e3ee3.txt\\\",\\n                \\\"http_body\\\": \\\"ca3-d4db80cdcb40496ab71a66a0ab985306\\\"\\n            },\\n            \\\"hostname\\\": \\\"example.com\\\"\\n        },\\n    ],\\n    \\\"success\\\": true,\\n    \\\"errors\\\": [],\\n    \\\"messages\\\": []\\n}\\n\\n\")), mdx(\"p\", null, \"This shows us the pending order created, and the HTTP DCV information required to complete validation is in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"verification_info\"), \" element.\"), mdx(\"p\", null, \"From here you can change the validation method to CNAME or TXT records.\"), mdx(\"p\", null, \"Let\\u2019s continue by changing the DCV method to CNAME.\"), mdx(\"h3\", {\n    \"id\": \"2-change-validation-method\"\n  }, \"2. Change validation method\"), mdx(\"p\", null, \"This endpoint will modify the validation method of a selected certificate order. Note the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"validation_method\"), \" value set in the request body.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"curl -X PATCH \\\"https://api.cloudflare.com/client/v4/zones/:zone_id/ssl/verification/<cert_pack_uuid>\\\" \\\\\\n     -H \\\"X-Auth-Email: user@example.com\\\" \\\\\\n     -H \\\"X-Auth-Key: API_KEY\\\" \\\\\\n     -H \\\"Content-Type: application/json\\\" \\\\\\n     --data '{\\\"validation_method\\\":\\\"cname\\\"}'\\n\\n{\\n    \\\"result\\\": {\\n        \\\"certificate_status\\\": \\\"pending_validation\\\",\\n        \\\"cert_pack_uuid\\\": \\\"4228d4df-b9c7-47bb-8903-ff76452458b1\\\",\\n        \\\"validation_method\\\": \\\"cname\\\",\\n        \\\"validation_type\\\": \\\"dv\\\",\\n        \\\"verification_info\\\": {\\n            \\\"cname\\\": \\\"_ca3-e82a555f7fe04fb394d2b14c7eb24946.example.com\\\",\\n            \\\"cname_target\\\": \\\"dcv.digicert.com\\\"\\n        },\\n        \\\"status\\\": \\\"pending_validation\\\",\\n        \\\"hostname\\\": \\\"example.com\\\"\\n    },\\n    \\\"success\\\": true,\\n    \\\"errors\\\": [],\\n    \\\"messages\\\": []\\n}\\n\")), mdx(\"p\", null, \"You can then take and set the values from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"verification_info\"), \" for a CNAME record in your authoritative DNS. This can be validated by performing this type of manual DNS lookup using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dig\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ dig _ca3-e82a555f7fe04fb394d2b14c7eb24946.example.com cname +short\\ndcv.digicert.com.\\n\")), mdx(\"h3\", {\n    \"id\": \"3-verify-status-is-now-active\"\n  }, \"3. Verify status is now active\"), mdx(\"p\", null, \"Once that is validated by the Certificate Authority, the \\u201CGet Validation Method\\u201D endpoint will show the order as\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"curl -sX GET \\\\\\n\\\"https://api.cloudflare.com/client/v4/zones/:zone_id/ssl/verification/\\\" \\\\\\n-H 'X-Auth-Email: YOUR_EMAIL' \\\\\\n-H 'X-Auth-Key: API_KEY'\\n\\n{\\n    \\\"result\\\": [\\n        {\\n            \\\"certificate_status\\\": \\\"active\\\",\\n            \\\"cert_pack_uuid\\\": \\\"4228d4df-b9c7-47bb-8903-ff76452458b1\\\",\\n            \\\"validation_method\\\": \\\"http\\\",\\n            \\\"validation_type\\\": \\\"dv\\\",\\n            \\\"hostname\\\": \\\"example.com\\\"\\n        }\\n    ],\\n    \\\"success\\\": true,\\n    \\\"errors\\\": [],\\n    \\\"messages\\\": []\\n}\\n\")), mdx(\"p\", null, \"The status: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"active\"), \" means that the certificate has been deployed to Cloudflare\\u2019s edge network, and will be served as soon as HTTP traffic is proxied to Cloudflare.\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"api-documentation\"\n  }, \"API documentation\"), mdx(\"p\", null, \"For more detail, see the Cloudflare API documentation on these operations:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://api.cloudflare.com/#ssl-verification-ssl-verification-details\"\n  }, \"Get SSL Verification Details\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://api.cloudflare.com/#ssl-verification-edit-ssl-certificate-pack-validation-method\"\n  }, \"Edit SSL Certificate Pack Validation Method\"))));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":null,"updated":null}}},"pageContext":{"id":"bf76252e-bfa7-56b9-bcbf-a4a3edc4f227","fields":{"slug":"/edge-certificates/universal-ssl/changing-dcv-method"},"frontmatter":{"title":"","type":null,"order":2,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Change DCV method","depth":1}],"tableOfContents":{"items":[{"url":"#change-dcv-method","title":"Change DCV method","items":[{"url":"#what-is-domain-control-validation-dcv","title":"What is Domain Control Validation (DCV)?"},{"url":"#completing-dcv-for-a-domain-using-cloudflare","title":"Completing DCV for a domain using Cloudflare"},{"url":"#apex-validation","title":"Apex validation","items":[{"url":"#1-check-validation-method","title":"1. Check validation method"},{"url":"#2-change-validation-method","title":"2. Change validation method"},{"url":"#3-verify-status-is-now-active","title":"3. Verify status is now active"}]},{"url":"#api-documentation","title":"API documentation"}]}]},"parent":{"modifiedTime":"2021-07-26","relativePath":"edge-certificates/universal-ssl/changing-dcv-method.md"}}},"staticQueryHashes":["9999"]}